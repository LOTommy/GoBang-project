<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    #user-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .user {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    button {
      background-color: #1e88e5;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #1976d2;
    }
  </style>
</head>
<body>
  <h1>Admin Panel</h1>
  <div id="user-list"></div>
  <div id="game-records"></div>

  <script>
    async function fetchUsers() {
      const response = await fetch('/admin/users');
      const users = await response.json();
      displayUsers(users);
    }

    async function fetchGameRecords(username) {
      const response = await fetch(`/admin/game-records/${username}`);
      const gameRecords = await response.json();
      displayGameRecords(gameRecords);
    }

    async function deleteUser(username) {
      const response = await fetch(`/admin/delete-user/${username}`, { method: 'DELETE' });
      if (response.ok) {
        alert('User deleted successfully');
        fetchUsers(); // Refresh the user list
      } else {
        alert('Error deleting user');
      }
    }

    function displayUsers(users) {
      const userList = document.getElementById('user-list');
      userList.innerHTML = '';
      users.forEach(user => {
        const userDiv = document.createElement('div');
        userDiv.textContent = `${user.username} (isAdmin: ${user.is_admin})`;
        const viewRecordsBtn = document.createElement('button');
        viewRecordsBtn.textContent = 'View Game Records';
        viewRecordsBtn.onclick = () => fetchGameRecords(user.username);
        const deleteUserBtn = document.createElement('button');
        deleteUserBtn.textContent = 'Delete User Account';
        deleteUserBtn.onclick = () => deleteUser(user.username);
        userDiv.appendChild(viewRecordsBtn);
        userDiv.appendChild(deleteUserBtn);
        userList.appendChild(userDiv);
      });
    }

    function displayGameRecords(gameRecords) {
      const gameRecordsDiv = document.getElementById('game-records');
      gameRecordsDiv.innerHTML = '';
      gameRecords.forEach(record => {
        const recordDiv = document.createElement('div');
        recordDiv.textContent = `Game ID: ${record.game_id}, Result: ${record.result}`;
        gameRecordsDiv.appendChild(recordDiv);
      });
    }

    // Fetch users and display them on the page
    fetchUsers();
  </script>
</body>
</html>
